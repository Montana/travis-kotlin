language: java
jdk:
  - openjdk8
env:
  - GOOGLE_APPLICATION_CREDENTIALS=$HOME/credentials.json
install:
  - echo $GOOGLE_APPLICATION_CREDENTIALS_B64 | base64 --decode >> $HOME/credentials.json
  - curl -sSLO https://github.com/pinterest/ktlint/releases/download/1.1.0/ktlint && chmod a+x ktlint && sudo mv ktlint /usr/local/bin/
script:
  - ./ktlint "**/*.kt"
  - chmod +x pubsub/gradlew
  - |
    for DIR in ./*/; do
      if [ -f $DIR/gradlew ]; then
        pushd $DIR
        ./gradlew test --console=plain --info
        popd
      fi
    done
